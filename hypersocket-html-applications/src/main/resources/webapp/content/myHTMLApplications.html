<div id="personalHTMLApplications">
</div>
<div id="launch"></div>
<div id="additionalActions"></div>

<script type="text/javascript">
	$(document).ready(function() {
		$('#personalHTMLApplications').localize();

		getJSON('menus/tableActions/htmlApplicationActions', null, function(data) {
			var actions = new Array();
			debugger;
			if(data.resources.length > 0) {
				$.each(data.resources, function(idx, action) {
					var div = action.resourceKey + 'Div';
					$('#additionalActions').append('<div id="' + div + '"></div>');
					$('#' + div).load(uiPath + '/content/' + action.url + '.html');

					actions.push({
						resourceKey : action.resourceKey,
						iconClass : action.iconClass,
						action : function(resource, callback) {
							if($('#' + action.resourceKey).data('action')) {
								$('#' + action.resourceKey).data('action')(resource, callback);
							}
						},
						enabled : true,
						enableFunction: action.enableFunction,
						displayFunction: action.displayFunction
					});
				});

				$('#launch').data('action', function(resource, callback) {
					var urlStr = resource.exe;
					var vpwidth = 800;
					var vpheight = 600;
					if('viewport.width' in resource.variablesMap) {
						vpwidth = parseInt(resource.variablesMap['viewport.width'], 10);
					}
					if('viewport.height' in resource.variablesMap) {
						vpheight = parseInt(resource.variablesMap['viewport.height'], 10);
					}

					/* TODO blegh .. we can't know how high the toolbar is at this point. Maybe
					 * at least the window could be resized when it is known */
					vpheight += 46;

					for(k in resource) {
						urlStr = urlStr.replace('${' + k + '}',resource[k]);
					}
					if(resource.windowTarget === 'TAB') {
						window.open(urlStr, resource.name, 'title=' + resource.name);
					}
					else if(resource.windowTarget === 'SAME') {
						window.location.href = urlStr;
					}
					else {
						window.open(urlStr, resource.name, 'height=' + vpheight + ',width=' + vpwidth + ',title=' + resource.name);
					}
				});
			}

			$('#personalHTMLApplications').ajaxResourcePage({
				id : "HTMLApplications",
				tableUrl : "hTMLApplications/personal",
				title: getResource("hTMLApplications.label"),
				icon: 'fa-folder-open',
				resourceUrl : "hTMLApplications",
				fields : [ {
					name : "name"
				}],
				resourceKey : "hTMLApplication",
				canCreate: false,
				canUpdate: false,
				canDelete: false,
				complete : function() {
					loadComplete();
				},
				additionalActions: actions
			});
		});
	});
</script>