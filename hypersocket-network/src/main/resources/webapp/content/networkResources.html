<div id="contentNetwork">
	<ul id="networkTabs">
		<li><a href="#tabEndPoints"><span localize="endpoints.label"></span></a></li>
		<li><a href="#tabProtocols"><span localize="protocols.label"></span></a></li>
	</ul>
	<div id="tabEndPoints"></div>
	<div id="tabProtocols"></div>
	

	<div id="addProtocolForm" class="dialog" dialog-for="tabProtocols">
		<form class="form">
			<div class="dialogError"></div>
			<div class="formInputField">
				<label for="protocolName" class="formLabel"
					localize="protocol.protocolName.label"></label> <input type="text"
					name="protocolName" id="protocolName"
					class="formInput text ui-widget-content ui-corner-all" />
			</div>
			<div class="formInputField">
				<label for="transport" class="formLabel"
					localize="protocol.transport.label"></label> <select
					name="transport" id="transport"
					class="formInput text ui-widget-content ui-corner-all">
					<option value="TCP">TCP</option>
					<option value="UDP">UDP</option>
				</select>
			</div>
			<div class="formInputField">
				<label for="start" class="formLabel" localize="protocol.start.label"></label>
				<input type="text" name="start" id="start"
					class="formInput text ui-widget-content ui-corner-all" />
			</div>
			<div class="formInputField">
				<label for="end" class="formLabelOptional"
					localize="protocol.end.label"></label> <input type="text"
					name="end" id="end"
					class="formInput text ui-widget-content ui-corner-all" />
			</div>
			<input type="hidden" id="protocolId" name="resourceId" value="" />
		</form>
	</div>

	<div id="addResourceForm" class="dialog" dialog-for="tabEndPoints">
		<form class="form">
			<div class="dialogError"></div>
			<div class="formInputField">
				<label for="resourceName" class="formLabel"
					localize="endpoint.resourceName.label"></label> <input type="text"
					name="resourceName" id="resourceName"
					class="formInput text ui-widget-content ui-corner-all" />
			</div>
			<div class="formInputField">
				<label for="hostname" class="formLabel"
					localize="endpoint.hostname.label"></label> <input type="text"
					name="hostname" id="hostname"
					class="formInput text ui-widget-content ui-corner-all" />
			</div>
			<div class="formInputField">
				<label for="destinationHostname" class="formLabel"
					localize="endpoint.destinationHostname.label"></label> <input type="text"
					name="destinationHostname" id="destinationHostname"
					class="formInput text ui-widget-content ui-corner-all" />
			</div>
			<div id="resourceTabs" class="tabContent">
				<ul id="addResourceFormTabs">
					<li><a href="#protocols"><span
							localize="endpoint.protocols.label"></span></a></li>
					<li><a href="#roles"><span localize="endpoint.roles.label"></span></a></li>
				</ul>
				<div id="protocols"></div>
				<div id="roles"></div>
			</div>
			<input type="hidden" id="resourceId" name="resourceId" value="" />
		</form>
	</div>
</div>

<script type="text/javascript">

	$(document).ready(function() {
		$('#contentNetwork').localize();
		$('#contentNetwork').tabs();
	
		getJSON('networkProtocols', null, function(data) {
			$('#protocols').multipleSelect({
				values : data.resources,
				selectedIsObjectList : true,
				resourceKey : 'endpoint'
			});
		});
	
		if(currentMenu.canCreate || currentMenu.canUpdate) {
			getJSON('roles', null, function(data) {
				$('#roles').multipleSelect({
					values : data.resources,
					selectedIsObjectList : true,
					resourceKey : 'endpoint'
				});
			});
		}
	
		$('#tabProtocols').resourcePage(
				{
				tableUrl : "networkProtocols",
				resourceUrl : "networkProtocol",
				fields : [ { name: "name" }, 
				           { name: "transport" },
				           { name: "portRange" } ],
				resourceKey : 'protocol',
				canCreate: currentMenu.canCreate,
				canUpdate: currentMenu.canUpdate,
				canDelete: currentMenu.canDelete,
				validate : function() {
					if ($('#protocolName').val() == '') {
						$('#addProtocolForm').resourceDialog('error',
								"error.nameRequired");
						return false;
					}

					if ($('#end').val() != ''
							&& $('#start').val() > $('#end').val()) {
						$('#addProtocolForm').resourceDialog('error',
								"error.portEndError");
						return false;
					}

					return true;
				},
				clearDialog : function() {
					$('#protocolName').val('');
					$('#transport').val('TCP');
					$('#start').val('');
					$('#end').val('');
					$('#protocolId').val('');
				},
				createResource : function() {
					protocol = new Object();
					protocol.name = $('#protocolName').val();
					protocol.transport = $('#transport').val();
					protocol.startPort = $('#start').val();
					protocol.endPort = $('#end').val();
					protocol.id = $('#protocolId').val();

					return protocol;
				},
				resourceCreated : function(resource) {
					$('#protocols').multipleSelect( { insert: [ resource ] });
				},
				displayResource : function(resource) {
					$('#protocolName').val(resource.name);
					$('#transport').val(resource.transport);
					$('#start').val(resource.startPort);
					$('#end').val(resource.endPort);
					$('#protocolId').val(resource.id);
				}
			});

		$('#tabEndPoints')
				.resourcePage(
						{
						id : "EndPoints",
						tableUrl : "networkResources",
						resourceUrl : "networkResource",
						fields : [ { name: "name" }, 
						           { name: "hostname" },
						           { name: "destinationHostname"}, 
						           { name: "protocolsDesc" } ],
						resourceKey : "endpoint",
						canCreate: currentMenu.canCreate,
						canUpdate: currentMenu.canUpdate,
						canDelete: currentMenu.canDelete,
						validate : function() {

							if ($('#resourceName').val() == '') {
								$('#addResourceForm').resourceDialog('error',
										"error.nameRequired");
								return false;
							}

							if ($('#hostname').val() == '') {
								$('#addResourceForm').resourceDialog('error',
										"error.hostnameRequired");
								return false;
							}
							
							if(isValidIpv4Address($('#hostname').val())
									|| isValidIpv6Address($('#hostname').val())) { 
								$('#addResourceForm').resourceDialog('error', "error.hostnameIsIPAddress");
								return false;
							}  
							
							if(!isValidHostname($('#hostname').val())) { 
				 				$('#addResourceForm').resourceDialog('error', "error.hostnameInvalid");
				 				return false;
				 			}  

							if($('#destinationHostname').val().length > 0) {
								if(!isValidHostname($('#destinationHostname').val()) 
										&& !isValidIpv4Address($('#destinationHostname').val()) 
										&& !isValidIpv6Address($('#destinationHostname').val())) {
									$('#addResourceForm').resourceDialog('error', "error.destinationInvalid");
					 				return false;
								}
							}
							return true;
						},
						clearDialog : function() {
							$('#resourceName').val('');
							$('#hostname').val('');
							$('#destinationHostname').val('');
							$('#protocols').multipleSelect();
							$('#roles').multipleSelect();
							$('#resourceId').val('');
						},
						createResource : function() {
							resource = new Object();
							resource.name = $('#resourceName').val();
							resource.hostname = $('#hostname').val();
							resource.destinationHostname = $('#destinationHostname').val();
							resource.protocols = $('#protocols')
									.multipleSelectValues();
							resource.roles = $('#roles').multipleSelectValues();
							resource.id = $('#resourceId').val();
							return resource;
						},
						displayResource : function(resource) {
							$('#resourceName').val(resource.name);
							$('#hostname').val(resource.hostname);
							$('#destinationHostname').val(resource.destinationHostname);
							$('#resourceId').val(resource.id);
							$('#protocols').multipleSelect({
								selected : resource.protocols,
								selectedIsObjectList : true,
								resourceKey : 'endpoint'
							});
							$('#roles').multipleSelect({
								selected : resource.roles,
								selectedIsObjectList : true,
								resourceKey : 'endpoint'
							});
						},
						complete : function() {

							$('#resourceTabs').tabs();

							loadComplete();
						}
					});
	});
</script>